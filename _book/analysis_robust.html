<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Thoughts and Advice on Writing your BAP - 16&nbsp; Heteroskedasticity and Robust Standard Errors</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./analysis_clustering.html" rel="next">
<link href="./analysis_pivot.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part_analysis.html">Practical Issues in Data Analysis</a></li><li class="breadcrumb-item"><a href="./analysis_robust.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Heteroskedasticity and Robust Standard Errors</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Thoughts and Advice on Writing your BAP</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_writing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Writing the Thesis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./writing_01_structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Structuring the Thesis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./writing_02_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./writing_03_review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Review of Literature and Argument</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./writing_04_design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Research Design/Data Section</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./writing_05_analyses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Results/Analyses Section</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./writing_06_conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./writing_07_general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">General Writing Advice</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Doing Research</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./doing_01_research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Finding Literature</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./doing_02_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Finding and Evaluating Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Practical Issues in Data Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Analysis Steps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Some Practical Questions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis_rscript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">R Script Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Regression Table Formatting Suggestion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis_04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Combining Plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis_pivot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Reshaping Datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis_robust.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Heteroskedasticity and Robust Standard Errors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Geographically Clustered/Nested Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#our-model" id="toc-our-model" class="nav-link active" data-scroll-target="#our-model"><span class="header-section-number">16.1</span> Our Model</a></li>
  <li><a href="#checking-the-assumption-and-finding-a-problem" id="toc-checking-the-assumption-and-finding-a-problem" class="nav-link" data-scroll-target="#checking-the-assumption-and-finding-a-problem"><span class="header-section-number">16.2</span> Checking the Assumption and Finding a Problem</a></li>
  <li><a href="#what-can-we-do" id="toc-what-can-we-do" class="nav-link" data-scroll-target="#what-can-we-do"><span class="header-section-number">16.3</span> What Can We Do?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part_analysis.html">Practical Issues in Data Analysis</a></li><li class="breadcrumb-item"><a href="./analysis_robust.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Heteroskedasticity and Robust Standard Errors</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-robust" class="quarto-section-identifier"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Heteroskedasticity and Robust Standard Errors</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="annotated-cell-1"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-1-1"><a href="#annotated-cell-1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Packages</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1">1</button><span id="annotated-cell-1-2" class="code-annotation-target"><a href="#annotated-cell-1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2">2</button><span id="annotated-cell-1-3" class="code-annotation-target"><a href="#annotated-cell-1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggResidpanel)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3">3</button><span id="annotated-cell-1-4" class="code-annotation-target"><a href="#annotated-cell-1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="4">4</button><span id="annotated-cell-1-5" class="code-annotation-target"><a href="#annotated-cell-1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="5">5</button><span id="annotated-cell-1-6" class="code-annotation-target"><a href="#annotated-cell-1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="6">6</button><span id="annotated-cell-1-7" class="code-annotation-target"><a href="#annotated-cell-1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="7">7</button><span id="annotated-cell-1-8" class="code-annotation-target"><a href="#annotated-cell-1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="annotated-cell-1-9"><a href="#annotated-cell-1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-1-10"><a href="#annotated-cell-1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Data</span></span>
<span id="annotated-cell-1-11"><a href="#annotated-cell-1-11" aria-hidden="true" tabindex="-1"></a>demdata <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"./data/demdata.rds"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="2" data-code-annotation="1">Used for several assumptions tests. Needs to be loaded <em>before</em> <code>tidyverse</code></span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="3" data-code-annotation="2">Assumptions checks through plots</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="4" data-code-annotation="3">Data importing</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="5" data-code-annotation="4">Data manipulation/plotting</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="6" data-code-annotation="5">Regression tables</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="7" data-code-annotation="6">Predicted values &amp; marginal effects</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="8" data-code-annotation="7">Model summaries</span>
</dd>
</dl>
</div>
</div>
<p>You should check the classic assumptions of the statistical model that you are using in your paper after running it. One of the classic assumptions for an OLS model is homoskedasticity. Homoskedasticity occurs when the variance of the model’s residuals are are about the same across model predictions. If this assumption fails, then your standard errors will be “downwardly biased” (that is, “too small”). This may mean rejecting the null hypothesis of no effect when you actually shouldn’t reject the null.</p>
<p>The Statistics II R materials discuss how to check this assumption in greater detail. This chapter provides some more tools for doing so. In addition, it discusses one potential tool you might use if you do find significant violations of this assumption.</p>
<section id="our-model" class="level2 page-columns page-full" data-number="16.1">
<h2 data-number="16.1" class="anchored" data-anchor-id="our-model"><span class="header-section-number">16.1</span> Our Model</h2>
<p>We need a model. I’ll use the same model as in the Statistics II example (but see my note below). Here, we regress a measure of political violence (<code>pve</code>) on a measure of a country’s level of democracy and a squared version of that democracy score to capture potential non-linearities in the relationship between democracy and violence. Here are the descriptive statistics for our DV and IV and then the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Descriptive Statistics</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>demdata <span class="sc">|&gt;</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pve, v2x_polyarchy) <span class="sc">|&gt;</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      pve          v2x_polyarchy   
 Min.   :-2.7081   Min.   :0.0150  
 1st Qu.:-0.7238   1st Qu.:0.2860  
 Median :-0.1978   Median :0.5290  
 Mean   :-0.2016   Mean   :0.5137  
 3rd Qu.: 0.5937   3rd Qu.:0.7545  
 Max.   : 1.4920   Max.   :0.9080  
 NA's   :15                        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Run the model</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>violence <span class="ot">&lt;-</span> <span class="fu">lm</span>(pve <span class="sc">~</span> v2x_polyarchy <span class="sc">+</span> <span class="fu">I</span>(v2x_polyarchy<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data=</span>demdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: I include the squared term in a different manner here than in the example in the Statistics II R materials. In those materials we first created a new variable in our data via <code>mutate()</code> (e.g., <code>mutate(v2x_polyarchy_sq = v2x_polyarchy^2)</code>. The use of <code>I()</code> will end up doing the same thing for me but without my having to manually create the squared term. In addition, the use of <code>I()</code> will make it a bit easier to get a nice plot of predicted values below using the <code>marignaleffects</code> package (this is a bit annoying to do with the manually created squared term).</p>
<p>Regardless, let’s look at our results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Summarize it</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(violence, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  term               estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)          -0.589     0.243     -2.42 0.0165      -1.07    -0.109
2 v2x_polyarchy        -1.73      1.10      -1.58 0.117       -3.90     0.438
3 I(v2x_polyarchy^2)    3.83      1.05       3.64 0.000361     1.75     5.90 </code></pre>
</div>
</div>
<p>Per above, <code>pve</code> ranges from -2.71 to +1.49. Higher values on this measure indicate <em>less</em> violence in a country. Higher values on our <code>v2x_polyarchy</code> measure indicate <em>greater</em> levels of electoral democracy. The coefficients here imply…</p>
<ul>
<li>Intercept: We should expect a <code>pve</code> score less than 0 (-0.589) when <code>v2x_polyarchy</code> (and its squared term) = 0</li>
<li>Coefficient for <code>v2x_polyarchy</code>: <code>pve</code> will decrease in value (i.e., violence will <em>increase</em> given how this variable is scaled) as <code>v2x_polyarchy</code> increases, but…</li>
<li>Coefficient for squared term: <code>pve</code> values will then start to increase (i.e., violence will decrease) as we move further along the polyarchy scale.</li>
</ul>
<p>In other words, there is a curvillinear relationship between the two variables.</p>
<p>It might be helpful to visualize this relationship to understand the coefficients. I will use a command from the <code>marginaleffects</code> package called <code>plot_predictions()</code>: this will create a plot of predicted values for us without us having to specify specific values of the predictor variable. This is particularly useful in instances where there is a squared term since increases in <code>v2x_polyarchy</code> necessarily imply increases in the squared term (e.g., it’s not really possible to look at an increase in <code>v2x_polyarchy</code> while holding constant its square).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;We could emulate this figure using a command in <code>marginaleffects</code> called <code>avg_predictions()</code> . For instance: <code>avg_predictions(violence, variables = "v2x_polyarchy")</code> would produce predicted variables across the range of <code>v2x_polyarchy</code> (at its minimum, 1st quarter, median, 3rd quarter, and maximum) along with confidence intervals which we could then plot. The bands for the confidence interval, however, would look a bit more jagged than what is produced by <code>plot_predictions()</code> .</p></div></div><div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_predictions</span>(violence, <span class="at">condition =</span> <span class="st">"v2x_polyarchy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_robust_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see a small decrease in <code>pve</code> as we move from <code>v2x_polyarchy</code> = 0 to <code>v2x_polyarchy</code> = 0.2 or so but then an increase in <code>pve</code> as the polyarchy variable continues to increase in value. We could use the <code>slopes()</code> function from marginal effects to directly estimate the slope for the line at different values of <code>v2x_polyarchy</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slopes</span>(violence, <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">v2x_polyarchy =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
          Term v2x_polyarchy Estimate Std. Error     z Pr(&gt;|z|)    S 2.5 %
 v2x_polyarchy          0.00   -1.731      1.098 -1.58    0.115  3.1 -3.88
 v2x_polyarchy          0.10   -0.965      0.893 -1.08    0.280  1.8 -2.72
 v2x_polyarchy          0.25    0.184      0.594  0.31    0.757  0.4 -0.98
 v2x_polyarchy          0.50    2.098      0.226  9.28   &lt;0.001 65.7  1.66
 v2x_polyarchy          0.75    4.013      0.549  7.31   &lt;0.001 41.7  2.94
 97.5 %
  0.421
  0.786
  1.347
  2.541
  5.089

Columns: rowid, term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, v2x_polyarchy, predicted_lo, predicted_hi, predicted, pve 
Type:  response </code></pre>
</div>
</div>
<p>The slope of a linear regression line is normally the same regardless of what value X takes on. However, the inclusion of the squared term relaxes this assumption. The slope is negative at at very low levels of polyarchy and then starts to peter out before becoming increasingly positive.</p>
</section>
<section id="checking-the-assumption-and-finding-a-problem" class="level2 page-columns page-full" data-number="16.2">
<h2 data-number="16.2" class="anchored" data-anchor-id="checking-the-assumption-and-finding-a-problem"><span class="header-section-number">16.2</span> Checking the Assumption and Finding a Problem</h2>
<p>Okay, let’s check our homoskedasticity assumption. Recall that we can do this by looking at a plot of the model’s residuals against its predictions. Ideally we will see a random cloud of dots without any obvious pattern.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> <em>Hetero</em>skedasticity, on the other hand, would commonly show up as some type of funnel shape as in the top left figure here:</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;If our DV was discrete (e.g., took on values 1 through 7), then we’d get a row of parallel dots.</p></div></div><p><img src="images/homo_hetero1.png" class="img-fluid"></p>
<p>We can use the <code>resid_panel()</code> command from the <code>ggResidpanel</code> library to do this, as so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">resid_panel</span>(violence, <span class="at">plots =</span> <span class="fu">c</span>(<span class="st">"resid"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_robust_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This looks problematic. There is a quite wide array of dots around -0.25 or so on the x-axis that then narrows when get towards 1 on the x-axis. This is a pretty noticeable pattern, so I’d feel comfortable saying that the assumption is being violated.</p>
<p>We can use some other tools to help us check this assumption as well, although these were not taught in Statistics II. There are formal statistical tests for assessing heteroskedasticity (not taught in Statistics II). In particular, we can perform what is known as a Breusch-Pagan test. The null hypothesis for this test is homoskedasticity, while the alternative hypothesis is heteroskedasticity. We can perform this test using the <code>bptest()</code> command from the <code>lmtest</code> library.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bptest</span>(violence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    studentized Breusch-Pagan test

data:  violence
BP = 14.584, df = 2, p-value = 0.0006811</code></pre>
</div>
</div>
<p>The p-value here is well below 0.05, which is our standard metric for assessing statistical significance. We can thus reject the null hypothesis of homoskedasticity.</p>
<p>One important note and caution about this test: it is sensitive to sample size much like any statistical significance test. In practice, this means that it becomes easier and easier to reject this null hypothesis with with more and more data in our model. However, our residuals are unlikely to be perfectly homoskedastic in actual data. We might thus find ourselves in situations where we can reject the null hypothesis of homoskedasticity but where there really isn’t a serious problem that we need to address. This is why we recommend focusing on the plot of residual values to see if there is a really noticeable trend there. The BP test can then be used to check one’s instincts.</p>
</section>
<section id="what-can-we-do" class="level2" data-number="16.3">
<h2 data-number="16.3" class="anchored" data-anchor-id="what-can-we-do"><span class="header-section-number">16.3</span> What Can We Do?</h2>
<p>We have found heteroskedasticity. That means we should be a bit careful with our claims of statistical significance. What can we do to address this issue?</p>
<p>Heteroskedaticity implies that our model is making better predictions for some observations than others. Ideally, then, we should try and improve our model to address this imbalance. That could involve adding predictors or perhaps transforming our variables in some fashion.</p>
<p>It is not always clear how exactly we should improve our model, however. One thing we could do in such a situation is to use what are known as “heteroskedastic-robust” or “<a href="https://en.wikipedia.org/wiki/Heteroskedasticity-consistent_standard_errors" target="_blank">heteroskedastic-consistent</a>” standard errors. These are standard errors that are calculated in a different way and which are more ‘robust’ to the violation of this assumption. Their use does not “fix” our problem - if heteroskedasticity is present due to a variable that is missing from our model, then using these SEs does not magically make our model better (or avoid the bias that the exclusion of the confounder introduces into our coefficient estimates). However, we could use this tool to probe whether our conclusions are robust to a more conservative test.</p>
<p>The easiest way to include heteroskedastic-robust standard errors in your results is via the <code>modelsummary()</code> command that you will use when reporting your regression results. See this <a href="https://modelsummary.com/vignettes/modelsummary.html#vcov" target="_blank">section</a> on the <code>marginaleffects</code> website. We can toggle the use of these SEs via the <code>vcov</code> option. There are various types of robust SEs, but we’ll use the “HC3” option as this is a pretty standard one. (Note: you might have to also install the <code>sandwich</code> library as <code>modelsummary</code> uses it to calculate the standard errors.)</p>
<p>Here is an example of how to do that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-9"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-9-1"><a href="#annotated-cell-9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(violence, </span>
<span id="annotated-cell-9-2"><a href="#annotated-cell-9-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">gof_map =</span> <span class="fu">c</span>(<span class="st">"nobs"</span>, <span class="st">"r.squared"</span>, <span class="st">"adj.r.squared"</span>), </span>
<span id="annotated-cell-9-3"><a href="#annotated-cell-9-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">stars =</span> T,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="1">1</button><span id="annotated-cell-9-4" class="code-annotation-target"><a href="#annotated-cell-9-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">vcov =</span> <span class="st">"HC3"</span>,</span>
<span id="annotated-cell-9-5"><a href="#annotated-cell-9-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">coef_rename =</span> <span class="fu">c</span>(</span>
<span id="annotated-cell-9-6"><a href="#annotated-cell-9-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">'(Intercept)'</span> <span class="ot">=</span> <span class="st">'Intercept'</span>, </span>
<span id="annotated-cell-9-7"><a href="#annotated-cell-9-7" aria-hidden="true" tabindex="-1"></a>               <span class="st">'v2x_polyarchy'</span> <span class="ot">=</span> <span class="st">'Polyarchy Score'</span>, </span>
<span id="annotated-cell-9-8"><a href="#annotated-cell-9-8" aria-hidden="true" tabindex="-1"></a>               <span class="st">'v2x_polyarchy_sq'</span> <span class="ot">=</span> <span class="st">'Polyarchy Squared'</span>), </span>
<span id="annotated-cell-9-9"><a href="#annotated-cell-9-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">notes =</span> <span class="fu">list</span>(<span class="st">"OLS Coefficients with Heteroskedastic-Robust SEs in Parentheses"</span>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-9" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="4" data-code-annotation="1">Changes the way the standard errors are calculated.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
 

  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tinytable_fovsl53sx7n7uslsff98</title>
    <style>
.table td.tinytable_css_umbub4471drapll8ef7c, .table th.tinytable_css_umbub4471drapll8ef7c {    border-bottom: solid 0.1em #d3d8dc; }
.table td.tinytable_css_nxs2nvu9z7fm44somn61, .table th.tinytable_css_nxs2nvu9z7fm44somn61 {    text-align: left; }
.table td.tinytable_css_sgfpi8xqxo7aq5tga1cl, .table th.tinytable_css_sgfpi8xqxo7aq5tga1cl {    text-align: center; }
.table td.tinytable_css_ha6m1qzbwc2eyrypscu0, .table th.tinytable_css_ha6m1qzbwc2eyrypscu0 {    border-bottom: solid 0.05em black; }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
  

  
    <div class="container">
      <table class="table table-borderless" id="tinytable_fovsl53sx7n7uslsff98" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">(1)</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan="2">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr>
<tr><td colspan="2">OLS Coefficients with Heteroskedastic-Robust SEs in Parentheses</td></tr></tfoot>
        <tbody>
                <tr>
                  <td>Intercept         </td>
                  <td>-0.589+ </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>(0.303) </td>
                </tr>
                <tr>
                  <td>Polyarchy Score   </td>
                  <td>-1.731  </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>(1.249) </td>
                </tr>
                <tr>
                  <td>I(v2x_polyarchy^2)</td>
                  <td>3.829***</td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>(1.107) </td>
                </tr>
                <tr>
                  <td>Num.Obs.          </td>
                  <td>164     </td>
                </tr>
                <tr>
                  <td>R2                </td>
                  <td>0.401   </td>
                </tr>
                <tr>
                  <td>R2 Adj.           </td>
                  <td>0.394   </td>
                </tr>
        </tbody>
      </table>
    </div>

    <script>
      function styleCell_tinytable_lea66c8feoulhfii1l62(i, j, css_id) {
        var table = document.getElementById("tinytable_fovsl53sx7n7uslsff98");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_fovsl53sx7n7uslsff98');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_tinytable_lea66c8feoulhfii1l62(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_fovsl53sx7n7uslsff98");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }

window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(0, 0, 'tinytable_css_umbub4471drapll8ef7c') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(0, 1, 'tinytable_css_umbub4471drapll8ef7c') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(0, 0, 'tinytable_css_nxs2nvu9z7fm44somn61') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(1, 0, 'tinytable_css_nxs2nvu9z7fm44somn61') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(2, 0, 'tinytable_css_nxs2nvu9z7fm44somn61') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(3, 0, 'tinytable_css_nxs2nvu9z7fm44somn61') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(4, 0, 'tinytable_css_nxs2nvu9z7fm44somn61') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(5, 0, 'tinytable_css_nxs2nvu9z7fm44somn61') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(6, 0, 'tinytable_css_nxs2nvu9z7fm44somn61') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(7, 0, 'tinytable_css_nxs2nvu9z7fm44somn61') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(8, 0, 'tinytable_css_nxs2nvu9z7fm44somn61') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(9, 0, 'tinytable_css_nxs2nvu9z7fm44somn61') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(0, 1, 'tinytable_css_sgfpi8xqxo7aq5tga1cl') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(1, 1, 'tinytable_css_sgfpi8xqxo7aq5tga1cl') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(2, 1, 'tinytable_css_sgfpi8xqxo7aq5tga1cl') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(3, 1, 'tinytable_css_sgfpi8xqxo7aq5tga1cl') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(4, 1, 'tinytable_css_sgfpi8xqxo7aq5tga1cl') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(5, 1, 'tinytable_css_sgfpi8xqxo7aq5tga1cl') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(6, 1, 'tinytable_css_sgfpi8xqxo7aq5tga1cl') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(7, 1, 'tinytable_css_sgfpi8xqxo7aq5tga1cl') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(8, 1, 'tinytable_css_sgfpi8xqxo7aq5tga1cl') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(9, 1, 'tinytable_css_sgfpi8xqxo7aq5tga1cl') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(6, 0, 'tinytable_css_ha6m1qzbwc2eyrypscu0') })
window.addEventListener('load', function () { styleCell_tinytable_lea66c8feoulhfii1l62(6, 1, 'tinytable_css_ha6m1qzbwc2eyrypscu0') })
    </script>

  


</div>
</div>
<p>The main difference from other examples you’ve seen is <code>vcov = "HC3"</code>. That is what will update the standard errors.</p>
<p>Let’s take a step back and compare results. Here is syntax that produces a regression table wherein Model 1 uses the standard SEs reported in <code>lm()</code> (the “classical” SEs) and Model 2 reports the robust version:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(violence, </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">gof_map =</span> <span class="fu">c</span>(<span class="st">"nobs"</span>, <span class="st">"r.squared"</span>, <span class="st">"adj.r.squared"</span>),</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">stars =</span> T, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">vcov =</span> <span class="fu">c</span>(<span class="st">"classical"</span>, <span class="st">"HC3"</span>), </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">coef_rename =</span> <span class="fu">c</span>(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">'(Intercept)'</span> <span class="ot">=</span> <span class="st">'Intercept'</span>, </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>               <span class="st">'v2x_polyarchy'</span> <span class="ot">=</span> <span class="st">'Polyarchy Score'</span>, </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>               <span class="st">'v2x_polyarchy_sq'</span> <span class="ot">=</span> <span class="st">'Polyarchy Squared'</span>), </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">notes =</span> <span class="fu">list</span>(<span class="st">"OLS Coefficients with Classic (Model 1) or Heteroskedastic-Robust (Model 2) SEs in Parentheses"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
 

  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tinytable_jlhy00qynwx37xxwhyry</title>
    <style>
.table td.tinytable_css_ztk7vve9b9dsmc3g2cl8, .table th.tinytable_css_ztk7vve9b9dsmc3g2cl8 {    border-bottom: solid 0.1em #d3d8dc; }
.table td.tinytable_css_3tikesk8kfzwot2z2e5d, .table th.tinytable_css_3tikesk8kfzwot2z2e5d {    text-align: left; }
.table td.tinytable_css_a0btbfh4fmgtj49nxw4i, .table th.tinytable_css_a0btbfh4fmgtj49nxw4i {    text-align: center; }
.table td.tinytable_css_m75cwrbfvj6qjgw7ocs8, .table th.tinytable_css_m75cwrbfvj6qjgw7ocs8 {    text-align: center; }
.table td.tinytable_css_uyqgx6olubyb1oxdl1jf, .table th.tinytable_css_uyqgx6olubyb1oxdl1jf {    border-bottom: solid 0.05em black; }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
  

  
    <div class="container">
      <table class="table table-borderless" id="tinytable_jlhy00qynwx37xxwhyry" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">(1)</th>
                <th scope="col">(2)</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan="3">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr>
<tr><td colspan="3">OLS Coefficients with Classic (Model 1) or Heteroskedastic-Robust (Model 2) SEs in Parentheses</td></tr></tfoot>
        <tbody>
                <tr>
                  <td>Intercept         </td>
                  <td>-0.589* </td>
                  <td>-0.589+ </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>(0.243) </td>
                  <td>(0.303) </td>
                </tr>
                <tr>
                  <td>Polyarchy Score   </td>
                  <td>-1.731  </td>
                  <td>-1.731  </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>(1.098) </td>
                  <td>(1.249) </td>
                </tr>
                <tr>
                  <td>I(v2x_polyarchy^2)</td>
                  <td>3.829***</td>
                  <td>3.829***</td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>(1.051) </td>
                  <td>(1.107) </td>
                </tr>
                <tr>
                  <td>Num.Obs.          </td>
                  <td>164     </td>
                  <td>164     </td>
                </tr>
                <tr>
                  <td>R2                </td>
                  <td>0.401   </td>
                  <td>0.401   </td>
                </tr>
                <tr>
                  <td>R2 Adj.           </td>
                  <td>0.394   </td>
                  <td>0.394   </td>
                </tr>
        </tbody>
      </table>
    </div>

    <script>
      function styleCell_tinytable_1t91ll55d40s9vtgm6k3(i, j, css_id) {
        var table = document.getElementById("tinytable_jlhy00qynwx37xxwhyry");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_jlhy00qynwx37xxwhyry');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_tinytable_1t91ll55d40s9vtgm6k3(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_jlhy00qynwx37xxwhyry");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }

window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(0, 0, 'tinytable_css_ztk7vve9b9dsmc3g2cl8') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(0, 1, 'tinytable_css_ztk7vve9b9dsmc3g2cl8') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(0, 2, 'tinytable_css_ztk7vve9b9dsmc3g2cl8') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(0, 0, 'tinytable_css_3tikesk8kfzwot2z2e5d') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(1, 0, 'tinytable_css_3tikesk8kfzwot2z2e5d') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(2, 0, 'tinytable_css_3tikesk8kfzwot2z2e5d') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(3, 0, 'tinytable_css_3tikesk8kfzwot2z2e5d') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(4, 0, 'tinytable_css_3tikesk8kfzwot2z2e5d') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(5, 0, 'tinytable_css_3tikesk8kfzwot2z2e5d') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(6, 0, 'tinytable_css_3tikesk8kfzwot2z2e5d') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(7, 0, 'tinytable_css_3tikesk8kfzwot2z2e5d') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(8, 0, 'tinytable_css_3tikesk8kfzwot2z2e5d') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(9, 0, 'tinytable_css_3tikesk8kfzwot2z2e5d') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(0, 1, 'tinytable_css_a0btbfh4fmgtj49nxw4i') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(1, 1, 'tinytable_css_a0btbfh4fmgtj49nxw4i') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(2, 1, 'tinytable_css_a0btbfh4fmgtj49nxw4i') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(3, 1, 'tinytable_css_a0btbfh4fmgtj49nxw4i') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(4, 1, 'tinytable_css_a0btbfh4fmgtj49nxw4i') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(5, 1, 'tinytable_css_a0btbfh4fmgtj49nxw4i') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(6, 1, 'tinytable_css_a0btbfh4fmgtj49nxw4i') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(7, 1, 'tinytable_css_a0btbfh4fmgtj49nxw4i') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(8, 1, 'tinytable_css_a0btbfh4fmgtj49nxw4i') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(9, 1, 'tinytable_css_a0btbfh4fmgtj49nxw4i') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(0, 2, 'tinytable_css_m75cwrbfvj6qjgw7ocs8') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(1, 2, 'tinytable_css_m75cwrbfvj6qjgw7ocs8') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(2, 2, 'tinytable_css_m75cwrbfvj6qjgw7ocs8') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(3, 2, 'tinytable_css_m75cwrbfvj6qjgw7ocs8') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(4, 2, 'tinytable_css_m75cwrbfvj6qjgw7ocs8') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(5, 2, 'tinytable_css_m75cwrbfvj6qjgw7ocs8') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(6, 2, 'tinytable_css_m75cwrbfvj6qjgw7ocs8') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(7, 2, 'tinytable_css_m75cwrbfvj6qjgw7ocs8') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(8, 2, 'tinytable_css_m75cwrbfvj6qjgw7ocs8') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(9, 2, 'tinytable_css_m75cwrbfvj6qjgw7ocs8') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(6, 0, 'tinytable_css_uyqgx6olubyb1oxdl1jf') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(6, 1, 'tinytable_css_uyqgx6olubyb1oxdl1jf') })
window.addEventListener('load', function () { styleCell_tinytable_1t91ll55d40s9vtgm6k3(6, 2, 'tinytable_css_uyqgx6olubyb1oxdl1jf') })
    </script>

  


</div>
</div>
<p>We can note a few things here:</p>
<ul>
<li>The coefficients have not changed. Altering the way the SE is calculated will not effect the coefficient estimate.</li>
<li>The HC3 SEs are slightly larger. This is typically what happens since heteroskedasticity introduces a downward bias (too small) on the standard errors.</li>
<li>Our overall conclusions are unchanged - while the SEs increase in value, the increase is pretty small and does not affect any of the statistical significance tests we care about.</li>
</ul>
<p>We can also incorporate these types of SEs into our plots of predicted values, etc., by using the <code>vcov</code> option in the requisite commands. For instance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot of predicted values</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_predictions</span>(violence, <span class="at">vcov =</span> <span class="st">"HC3"</span>, <span class="at">condition =</span> <span class="st">"v2x_polyarchy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_robust_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Slopes at various levels of democracy</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">slopes</span>(violence, <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">v2x_polyarchy =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>)), <span class="at">vcov =</span> <span class="st">"HC3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
          Term v2x_polyarchy Estimate Std. Error      z Pr(&gt;|z|)    S 2.5 %
 v2x_polyarchy          0.00   -1.731      1.249 -1.386    0.166  2.6 -4.18
 v2x_polyarchy          0.10   -0.965      1.031 -0.936    0.349  1.5 -2.99
 v2x_polyarchy          0.25    0.184      0.708  0.259    0.795  0.3 -1.20
 v2x_polyarchy          0.50    2.098      0.239  8.778   &lt;0.001 59.1  1.63
 v2x_polyarchy          0.75    4.013      0.475  8.449   &lt;0.001 54.9  3.08
 97.5 %
  0.717
  1.055
  1.572
  2.567
  4.943

Columns: rowid, term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, v2x_polyarchy, predicted_lo, predicted_hi, predicted, pve 
Type:  response </code></pre>
</div>
</div>
<p>Again, the only thing that will really change are the standard errors and, by extension, the confidence intervals.</p>


</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./analysis_pivot.html" class="pagination-link" aria-label="Reshaping Datasets">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Reshaping Datasets</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./analysis_clustering.html" class="pagination-link" aria-label="Geographically Clustered/Nested Data">
        <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Geographically Clustered/Nested Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>